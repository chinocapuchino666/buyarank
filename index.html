<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>BuyARank</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; max-width:720px; margin:20px auto; padding:18px; }
    h1 { text-align:center; margin-bottom:6px; }
    p.lead { text-align:center; color:#555; margin-top:0; margin-bottom:18px; }
    .row{display:flex;gap:10px;margin-bottom:10px;}
    input[type="number"], input[type="text"]{flex:1;padding:8px;border:1px solid #ddd;border-radius:4px;}
    button{padding:10px;border:none;border-radius:6px;background:#ff6b00;color:white;cursor:pointer;}
    .ranking{margin-top:18px;border-top:1px solid #eee;padding-top:10px;}
    .item{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid #fafafa;}
    .small{font-size:0.9em;color:#666;}
    .note{font-size:0.9em;color:#a00;margin-top:10px;}
    @media(max-width:480px){body{padding:12px}}
  </style>
</head>
<body>

  <h1>BuyARank</h1>
  <p class="lead">Pagás, elegís un número y ponés tu alias. (Prototipo)</p>

  <div>
    <label class="small">Número</label>
    <div class="row">
      <input id="numInput" type="number" min="1" placeholder="Ej: 7" />
      <button id="calcBtn" type="button">Calcular precio</button>
    </div>

    <label class="small">Alias</label>
    <input id="aliasInput" type="text" placeholder="Tu alias público (ej: @pepito)" />

    <p class="small">Precio actual: <strong id="priceText">—</strong></p>
    <button id="buyBtn">Comprar puesto</button>
    <p class="note">Nota: esto es un prototipo. Las compras son simuladas y se guardan en este navegador.</p>
  </div>

  <div class="ranking">
    <h3>Ranking (guardado en este navegador)</h3>
    <div id="rankingList"></div>
  </div>

<script>
/* Config */
const BASE_PRICE = 1; // precio inicial

/* Helpers de almacenamiento local */
function loadState() {
  const raw = localStorage.getItem('buyarank_state');
  return raw ? JSON.parse(raw) : { numbers: {} };
}
function saveState(state) {
  localStorage.setItem('buyarank_state', JSON.stringify(state));
}

/* Estado en memoria */
let state = loadState();

/* Elementos */
const numInput = document.getElementById('numInput');
const aliasInput = document.getElementById('aliasInput');
const priceText = document.getElementById('priceText');
const buyBtn = document.getElementById('buyBtn');
const rankingList = document.getElementById('rankingList');
const calcBtn = document.getElementById('calcBtn');

/* Renderizar ranking */
function renderRanking() {
  // Mostrar hasta el máximo número presente o al menos 10
  const keys = Object.keys(state.numbers).map(k => parseInt(k));
  const maxNum = Math.max(10, ...keys, 0);
  rankingList.innerHTML = '';
  for (let i = 1; i <= maxNum; i++) {
    const entry = state.numbers[i];
    const alias = entry ? entry.alias : '(libre)';
    const price = entry ? entry.price : BASE_PRICE;
    const div = document.createElement('div');
    div.className = 'item';
    div.innerHTML = `<div><strong>#${i}</strong> — <span class="small">${alias}</span></div>
                     <div class="small">$${price}</div>`;
    rankingList.appendChild(div);
  }
}

/* Calcular precio actual para un número */
function precioActual(num) {
  const entry = state.numbers[num];
  return entry ? entry.price * 2 : BASE_PRICE;
}

/* Actualizar texto de precio cuando cambie el input */
function updatePriceText() {
  const n = parseInt(numInput.value);
  if (!n || n < 1) {
    priceText.innerText = '—';
    return;
  }
  priceText.innerText = '$' + precioActual(n);
}

/* Comprar (simulado) */
function comprar() {
  const n = parseInt(numInput.value);
  const alias = aliasInput.value && aliasInput.value.trim();
  if (!n || n < 1) return alert('Ingresá un número válido.');
  if (!alias) return alert('Ingresá un alias (ej: @pepito).');

  const amount = precioActual(n);
  // Simulamos el pago: en un MVP real aquí iría Stripe/MP
  const ok = confirm(`Vas a comprar #${n} por $${amount}. Confirmar compra?`);
  if (!ok) return;

  // Guardar en localStorage: establecer dueño y precio (precio pagado)
  state.numbers[n] = { alias: alias, price: amount };
  saveState(state);
  renderRanking();

  // limpiar campos
  aliasInput.value = '';
  numInput.value = '';
  priceText.innerText = '—';
  alert(`¡Listo! Sos dueño de #${n} por $${amount} (guardado en este navegador).`);
}

/* Eventos */
numInput.addEventListener('input', updatePriceText);
calcBtn.addEventListener('click', updatePriceText);
buyBtn.addEventListener('click', comprar);

/* Inicializar */
renderRanking();
updatePriceText();
</script>

</body>
</html>
